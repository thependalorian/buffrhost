# Product Requirements Prompt (PRP) - The Shandi Comprehensive Hospitality Ecosystem Management Platform

## Goal

Build a comprehensive cloud-based hospitality ecosystem management platform that combines CRM-driven customer engagement, AI-powered business intelligence, and streamlined operational tools. The platform should enable hospitality properties (restaurants, hotels, spas, conference facilities, transportation services, and all amenities) to manage digital menus, process orders, track inventory, analyze customer behavior, and automate marketing campaigns through a unified system across all hospitality services.

## Why

- **Market Need**: Hospitality properties struggle with fragmented systems for POS, inventory, CRM, marketing, and multi-service management
- **Customer Experience**: Digital-first ordering and personalized service across all hospitality amenities drive customer loyalty
- **Operational Efficiency**: AI automation reduces manual work and human errors across all hospitality services
- **Data-Driven Growth**: Comprehensive analytics enable informed business decisions across all service types
- **Scalability**: Multi-tenant architecture supports hospitality chains, franchises, and multi-service properties
- **Cross-Service Integration**: Unified platform eliminates silos between restaurant, hotel, spa, conference, and other hospitality services

## What

### Core Features

**Customer-Facing Features:**
- Dynamic digital menus with QR code access for all hospitality services
- Real-time ordering and payment processing across all services
- Order tracking and notifications for all hospitality amenities
- Cross-service loyalty programs with unified redemption across all services
- Personalized recommendations and promotions across all hospitality services

**Business Operations:**
- Comprehensive inventory management with AI alerts across all hospitality services
- Cross-service sales analytics and business intelligence dashboards
- CRM-driven customer profiles and segmentation across all services
- Advanced digital loyalty system with cross-service redemption and point transfers
- Automated marketing campaign generation for all hospitality services
- Multi-location and multi-service management capabilities

**Technical Capabilities:**
- RAG-powered Q&A system for comprehensive hospitality business insights
- Conversational AI for guest messaging and 24/7 support
- AI-powered cross-service recommendations and personalization
- Real-time inventory tracking and deduction across all services
- Advanced digital loyalty system with QR code integration for all services
- Cross-service loyalty redemption and point transfers across all hospitality amenities
- Secure payment processing integration for all service types
- Mobile-responsive web application for comprehensive hospitality management
- API-first architecture for integrations across all hospitality services

### Product Design Specifications

**Desktop Optimized Web App for Hospitality Management:**
- Comprehensive dashboard with real-time analytics and insights across all services
- Multi-service menu management with drag-and-drop interface
- Unified order management with kitchen display system integration for all services
- Cross-service inventory tracking with automated alerts
- Customer relationship management tools with loyalty integration across all services
- Settings and configuration management for comprehensive hospitality ecosystem

**Customer Mobile Experience:**
- QR code scanning for instant access to all hospitality services
- Interactive menu browsing with categories and search across all services
- Customizable item selection with modifiers for all service types
- Real-time cart management across all hospitality services
- Secure checkout with multiple payment options for all services
- Order tracking and status updates across all hospitality amenities

**Hospitality Services Features:**
- Comprehensive room service management for hotels with loyalty integration
- Multi-service table assignment and management with QR code setup
- Kitchen display system (KDS) integration for all F&B services
- Real-time order queue management across all hospitality services
- Customer communication tools for all service types
- Cross-service revenue analytics and reporting
- Comprehensive loyalty system for all hospitality services
- Unified loyalty wallet with point transfers between all service types
- Spa, conference, transportation, recreation, and specialized services management
- Cross-service booking and reservation management

### Detailed UI/UX Specifications

**Hospitality Management Dashboard Features:**
- Cross-service revenue projections and guest count forecasting
- Peak time analysis with capacity planning across all services
- Best selling items with sales analytics for all service types
- Multi-service supply management with automated reorder alerts
- Monthly revenue comparison across all services (vs. previous month/year)
- Real-time metrics with live updates for all hospitality services
- Cross-service loyalty analytics with customer lifetime value and redemption patterns
- Comprehensive insights showing how loyalty drives bookings across all services

**Customer Landing Page (QR Code Scanned):**
- Hospitality property logo and welcome message
- Specialties/popular items carousel across all services
- Menu items with images, names, prices, and descriptions for all services
- Category navigation with horizontal scroll for all service types
- Search functionality for all hospitality services
- Dynamic cart with total price display across all services
- Cross-service loyalty enrollment prompt with QR code scanning
- Real-time loyalty point balance display across all services

**Menu Item Detail Screen:**
- High-resolution item images
- Complete item descriptions and nutritional information
- Customizable dropdown options with pricing
- Quantity selection with plus/minus controls
- Special instructions text input
- Add to cart button with total price

**Checkout Cart Experience:**
- Hospitality property branding and information
- Individual cart item management with edit capabilities across all services
- Add more items with recommendations from all service types
- Tip selection (10%, 15%, 20%, custom, none) for applicable services
- Customer information collection (name, email, phone)
- Terms of service and communication consent
- Cross-service loyalty point redemption options with available rewards
- Secure checkout with total amount display for all services
- Automatic loyalty point earning with transaction confirmation across all services

**Hospitality Services Management:**
- Unified order queue with real-time updates and customizable sorting across all services
- Complete order details with customer information for all service types
- Order status management (received, in preparation, ready, completed) across all services
- Table/room assignment for dine-in, room service, and all hospitality services
- Kitchen display system (KDS) integration for all F&B services
- Payment processing and receipt management for all services
- Customer communication and issue resolution tools across all services
- Order history and customer preference analysis across all hospitality services
- Cross-service loyalty integration with point transfers across all amenities
- Unified loyalty wallet management across all hospitality services

**Settings and Configuration:**
- General settings (language, table layout, QR code setup) for all services
- Account management and subscription billing for comprehensive hospitality platform
- Notification preferences (customer feedback, system alerts, inventory) across all services
- Order management (operating hours, limits, preparation times) for all service types
- Payment settings with bank integration for all services
- Reporting and analytics controls for comprehensive hospitality ecosystem
- Support documentation and contact information for all hospitality services

### Enhanced Digital Loyalty System

**Core Loyalty Features:**
- QR code-based loyalty enrollment and point claiming across all hospitality services
- Mobile-first loyalty wallet with real-time point balance across all services
- Contactless integration with payment systems (Stripe, PayPal, Apple Pay, Google Pay) for all services
- Digital stamp cards combining traditional punch card simplicity with mobile convenience across all services

**Restaurant-Specific Loyalty:**
- Menu-based rewards with points for trying new dishes and seasonal items
- Time-based incentives with extra points during off-peak hours
- Service type differentiation (takeout vs. dine-in vs. delivery)
- Group dining rewards for table reservations and large orders

**Hotel-Specific Loyalty:**
- Room service integration with automatic loyalty enrollment
- Stay-based rewards with points for room bookings and extended stays
- Comprehensive amenity usage rewards for spa services, conference facilities, fitness centers, shuttle services, camping facilities, recreation services, business center, laundry services, valet parking, concierge services, and gift shop
- Length of stay bonuses with escalating point structures
- Multi-service integration with cross-service point earning and unified redemption

**Cross-Service Integration:**
- Unified loyalty wallet across all hospitality services
- Point transfers between all service types with customizable exchange rates
- Shared VIP status and tier advancement across all hospitality services
- Combined spending thresholds for cross-service tier benefits
- Multi-service integration with points earned from any hospitality service (restaurant, hotel, spa, conference, transportation, recreation, etc.)
- Service bundle rewards with bonus points for using multiple services

**Advanced Loyalty Features:**
- Personalized rewards based on customer behavior and preferences across all services
- Tier-based loyalty system with multiple benefit levels across all hospitality services
- Referral programs with bonus points for successful referrals across all services
- Social sharing integration with points for check-ins and reviews across all services
- Location-aware offers with GPS-triggered promotions for all hospitality services
- Automated campaign management with time-limited promotions across all services

### Success Criteria

- [ ] Complete database schema with all 20 tables implemented for comprehensive hospitality ecosystem
- [ ] RESTful API endpoints for all CRUD operations across all hospitality services
- [ ] Authentication and authorization system for multi-service hospitality management
- [ ] Real-time order processing workflow across all hospitality services
- [ ] Inventory management with automatic deduction across all service types
- [ ] Cross-service customer loyalty point system
- [ ] Business intelligence dashboard for comprehensive hospitality ecosystem
- [ ] Mobile-responsive frontend interface for all hospitality services
- [ ] Payment processing integration for all service types
- [ ] Multi-tenant hospitality property management

## All Needed Context

### Documentation & References

```yaml
# Database Schema
- file: database/schema.sql
  why: Complete PostgreSQL schema with all restaurant operations tables

# Technical Architecture
- file: docs/architecture.md
  why: System design and technology stack decisions

# API Documentation
- file: docs/api-specification.md
  why: REST API endpoints and data models

# Frontend Components
- file: frontend/components/
  why: React components for restaurant management interface
```

### Existing Codebase Patterns

```yaml
# Backend Structure
- directory: backend/
  purpose: FastAPI application with database models and endpoints
  patterns: Pydantic models, SQLAlchemy ORM, async/await patterns

# Frontend Structure  
- directory: frontend/
  purpose: Next.js application with TypeScript
  patterns: React components, Tailwind CSS, DaisyUI components

# Database Models
- file: backend/models/
  purpose: SQLAlchemy models matching database schema
  patterns: Relationship definitions, validation rules, indexes
```

### Technology Stack

**Backend:**
- FastAPI for REST API development
- SQLAlchemy for database ORM
- PostgreSQL with pgvector for RAG capabilities
- Redis for caching and real-time features
- Pydantic for data validation

**Frontend:**
- Next.js 14 with App Router
- TypeScript for type safety
- Tailwind CSS and DaisyUI for styling
- React Query for data fetching
- Zustand for state management

**Infrastructure:**
- Supabase for database hosting
- Vercel for frontend deployment
- Docker for containerization
- GitHub Actions for CI/CD

### Known Gotchas & Implementation Notes

```python
# Database Relationships
- Order table uses "Order" as name (quoted) due to SQL reserved word
- UUID primary keys for Customer and Order tables
- Composite primary keys for many-to-many relationships
- Proper foreign key constraints with CASCADE deletes

# Business Logic
- Inventory deduction happens in real-time when orders are placed
- Loyalty points are calculated based on order total
- Menu availability depends on inventory levels
- Order status transitions: pending → in_progress → completed

# Security Considerations
- Password hashing with bcrypt
- JWT tokens for authentication
- Role-based access control (RBAC)
- Input validation and SQL injection prevention
```

## Implementation Blueprint

### Phase 1: Database & Core Models (Week 1)

**Task 1.1: Database Setup**
- Create PostgreSQL database with schema
- Set up connection pooling and migrations
- Implement database seeding with sample data
- Create database indexes for performance

**Task 1.2: Backend Models**
- Implement SQLAlchemy models for all 20 tables
- Define relationships and constraints
- Create Pydantic schemas for API serialization
- Add validation rules and business logic

**Task 1.3: Authentication System**
- Implement user registration and login
- Create JWT token management
- Set up role-based permissions
- Add password reset functionality

### Phase 2: Core API Endpoints (Week 2)

**Task 2.1: Restaurant Management**
- CRUD operations for restaurants
- User management and role assignment
- Menu category and item management
- Media upload and management

**Task 2.2: Order Processing**
- Order creation and management
- Order item and option handling
- Order status updates and tracking
- Payment processing integration

**Task 2.3: Inventory Management**
- Inventory item CRUD operations
- Real-time stock tracking
- Low stock alerts and notifications
- Supplier and batch management

### Phase 3: Business Intelligence (Week 3)

**Task 3.1: Analytics Dashboard**
- Sales reporting and trends
- Customer behavior analysis
- Inventory usage patterns
- Revenue and profit calculations

**Task 3.2: RAG-Powered Insights**
- Vector database setup with pgvector
- Natural language query processing
- Business insight generation
- Automated report creation

**Task 3.3: Enhanced Loyalty System**
- Advanced digital loyalty system with QR code integration
- Cross-business loyalty redemption and point transfers
- Tier-based loyalty system with multiple benefit levels
- Automated campaign management with personalized rewards
- Referral programs and social sharing integration
- Location-aware offers and GPS-triggered promotions

### Phase 4: Frontend Development (Week 4)

**Task 4.1: Restaurant Dashboard Components**
- Analytics dashboard with revenue projections and peak time analysis
- Menu management interface with drag-and-drop functionality
- Order management with real-time queue and KDS integration
- Inventory management with supply tracking and alerts
- Customer relationship management tools

**Task 4.2: Customer Mobile Experience**
- QR code landing page with restaurant branding and welcome message
- Interactive menu browsing with categories, search, and carousel displays
- Menu item detail screens with high-resolution images and customization options
- Shopping cart with real-time updates and item management
- Checkout flow with customer information, tip selection, and payment
- Order tracking and status notifications
- Loyalty enrollment and point balance display
- Loyalty point redemption options during checkout
- Cross-business loyalty wallet with point transfers

**Task 4.3: Hospitality Services Features**
- Room service management for hotels with table/room assignment
- Table assignment and layout management with QR code setup
- Kitchen display system (KDS) integration for order preparation
- Real-time order queue with customizable sorting and status updates
- Customer communication and feedback tools with issue resolution
- Revenue analytics and reporting dashboards with performance metrics

**Task 4.4: Settings and Configuration**
- General settings (language preferences, table layout, QR code setup)
- Account management and subscription billing with profile management
- Notification preferences (customer feedback, system alerts, inventory management)
- Order management settings (operating hours, order limits, preparation times)
- Payment integration with bank connections and processing setup
- Reporting and analytics controls with dashboard customization

### Phase 5: Integration & Testing (Week 5)

**Task 5.1: Payment Integration**
- Stripe payment processing
- PayPal integration
- Gift card and loyalty point redemption
- Refund and cancellation handling

**Task 5.2: External Integrations**
- POS system connections
- Accounting software sync
- Third-party delivery platforms
- Social media marketing tools

**Task 5.3: Testing & Deployment**
- Unit and integration testing
- Performance optimization
- Security audit and fixes
- Production deployment setup

## Validation Loop

### Level 1: Database Validation

```bash
# Schema validation
psql -d the_shandi -f database/schema.sql
# Expected: All tables created successfully with proper constraints

# Data integrity tests
python scripts/test_database_integrity.py
# Expected: All foreign key relationships work correctly
```

### Level 2: API Validation

```bash
# Endpoint testing
pytest backend/tests/ -v
# Expected: All API endpoints return correct responses

# Authentication testing
python scripts/test_auth_flow.py
# Expected: Login/logout and permission checks work
```

### Level 3: Business Logic Validation

```bash
# Order processing test
python scripts/test_order_workflow.py
# Expected: Orders process correctly with inventory deduction

# Inventory management test
python scripts/test_inventory_management.py
# Expected: Stock levels update accurately
```

### Level 4: Frontend Validation

```bash
# Component testing
npm run test
# Expected: All React components render correctly

# E2E testing
npm run test:e2e
# Expected: Complete user workflows function properly
```

### Level 5: Integration Validation

```bash
# Payment processing test
python scripts/test_payment_integration.py
# Expected: Stripe/PayPal transactions complete successfully

# Performance testing
python scripts/load_test.py
# Expected: System handles expected user load
```

## Test Plan

### Unit Testing
- **Component Testing**: Individual React component functionality validation
- **API Testing**: Backend endpoint validation with proper HTTP status codes
- **Database Testing**: Data integrity and relationship validation
- **Authentication Testing**: Login/logout and permission validation

### Integration Testing
- **Order Workflow**: Complete order processing from creation to completion
- **Payment Integration**: Payment processing with external providers (Stripe/PayPal)
- **Inventory Management**: Real-time inventory updates and alerts
- **Customer Management**: Customer profile and loyalty point management

### End-to-End Testing
- **Customer Journey**: Complete customer ordering experience from QR scan to checkout
- **Restaurant Management**: Full restaurant operation workflow
- **Multi-tenant Testing**: Multiple restaurant management capabilities
- **Performance Testing**: Load testing and performance validation

### User Acceptance Testing
- **Restaurant Staff**: Staff workflow validation and usability testing
- **Customer Experience**: Customer interface usability and mobile responsiveness
- **Administrative Functions**: Management tool effectiveness and efficiency
- **Mobile Responsiveness**: Cross-device compatibility and responsive design

## Roll Out Plan and Objectives

### Phase 1: Foundation (Weeks 1-2)
**Objectives:**
- Complete database schema implementation with all 20 tables
- Establish core API endpoints for all CRUD operations
- Set up authentication system with JWT and role-based access
- Create basic frontend structure with Next.js and TypeScript

**Deliverables:**
- Functional database with all 20 tables and relationships
- Core REST API endpoints with proper validation
- JWT authentication system with user management
- Basic React component structure with Tailwind CSS

### Phase 2: Core Features (Weeks 3-4)
**Objectives:**
- Implement restaurant management features and dashboard
- Create customer ordering interface with QR code scanning
- Set up order processing workflow with real-time updates
- Implement inventory management with automated alerts

**Deliverables:**
- Restaurant dashboard with analytics and insights
- Customer mobile interface with menu browsing and cart
- Order management system with status tracking
- Inventory tracking system with low-stock alerts

### Phase 3: Advanced Features (Weeks 5-6)
**Objectives:**
- Implement analytics and reporting with business intelligence
- Add payment processing integration with Stripe/PayPal
- Create loyalty program features with point management
- Set up notification systems for real-time updates

**Deliverables:**
- Business intelligence dashboard with revenue analytics
- Payment processing integration with multiple providers
- Customer loyalty system with point redemption
- Real-time notification system with SMS/email alerts

### Phase 4: Testing & Optimization (Weeks 7-8)
**Objectives:**
- Comprehensive testing across all features and user journeys
- Performance optimization for mobile and desktop
- Security audit and vulnerability fixes
- User acceptance testing with restaurant partners

**Deliverables:**
- Tested and optimized application with performance benchmarks
- Security audit report with vulnerability fixes
- Performance benchmarks meeting <2 second load times
- User feedback integration and interface improvements

### Phase 5: Deployment & Launch (Weeks 9-10)
**Objectives:**
- Production deployment setup with monitoring and logging
- User training and documentation creation
- Soft launch with select restaurant partners
- Full public launch with marketing and support

**Deliverables:**
- Production-ready application with monitoring
- User documentation and training materials
- Launch marketing materials and onboarding guides
- Customer support system with help documentation

### Success Metrics
- **Technical Metrics**:
  - 99.9% uptime with monitoring and alerting
  - <2 second page load times on mobile and desktop
  - Zero critical security vulnerabilities
  - 100% test coverage for core features

- **Business Metrics**:
  - 50+ restaurants onboarded in first month
  - 1000+ customer orders processed successfully
  - 90%+ customer satisfaction rating
  - 25% increase in restaurant operational efficiency

- **User Experience Metrics**:
  - <3 clicks to complete order from QR scan to checkout
  - 95%+ mobile responsiveness score across devices
  - 90%+ accessibility compliance (WCAG 2.1 AA)
  - <5% user error rate in order completion

## Final Validation Checklist

- [ ] Database schema matches all 20 table specifications
- [ ] All API endpoints return proper HTTP status codes
- [ ] Authentication and authorization work correctly
- [ ] Order processing deducts inventory accurately
- [ ] Loyalty points calculate and redeem properly
- [ ] Business intelligence queries return correct data
- [ ] Frontend components are responsive and accessible
- [ ] Payment processing integrates successfully
- [ ] Multi-tenant architecture supports multiple restaurants
- [ ] Security measures prevent common vulnerabilities
- [ ] Performance meets requirements under load
- [ ] Documentation is complete and accurate
- [ ] UI/UX specifications match design requirements
- [ ] Customer journey flows work end-to-end
- [ ] Restaurant management features are fully functional
- [ ] Hospitality services features support hotel operations
- [ ] Test plan covers all critical user scenarios
- [ ] Rollout plan addresses all deployment phases

---

## Anti-Patterns to Avoid

- ❌ Don't hardcode restaurant-specific logic in shared components
- ❌ Don't skip input validation on API endpoints
- ❌ Don't ignore database transaction boundaries
- ❌ Don't store sensitive data in client-side storage
- ❌ Don't create overly complex database relationships
- ❌ Don't skip error handling in async operations
- ❌ Don't ignore mobile responsiveness in UI design
- ❌ Don't forget to implement proper logging and monitoring
